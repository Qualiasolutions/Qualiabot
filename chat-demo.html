<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QualiaBot Chat Demo</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #10121F;
      color: #fff;
      height: 100%;
    }
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 10px;
      box-sizing: border-box;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 12px;
      margin-bottom: 5px;
      word-wrap: break-word;
    }
    .bot-message {
      align-self: flex-start;
      background-color: rgba(0, 164, 172, 0.15);
      border: 1px solid rgba(0, 164, 172, 0.2);
      border-bottom-left-radius: 4px;
    }
    .user-message {
      align-self: flex-end;
      background-color: #2A2C3E;
      border-bottom-right-radius: 4px;
    }
    .chat-input {
      display: flex;
      padding: 10px;
      gap: 8px;
      border-top: 1px solid rgba(0, 164, 172, 0.2);
    }
    .chat-input input {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(0, 164, 172, 0.2);
      background-color: #1A1C2E;
      color: #fff;
      font-size: 14px;
      outline: none;
    }
    .chat-input button {
      background-color: rgba(0, 164, 172, 0.8);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 0 20px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    .chat-input button:hover {
      background-color: rgba(0, 164, 172, 1);
    }
    .loading {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .loading-dot {
      width: 6px;
      height: 6px;
      background-color: rgba(0, 164, 172, 0.6);
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }
    .loading-dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    .loading-dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.4; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-messages" id="chat-messages">
      <div class="message bot-message">ðŸ‘‹ Hello! I'm QualiaBot, your AI assistant for Qualia Solutions. I can help with web design, AI integration, and custom software development questions.</div>
    </div>
    <div class="chat-input">
      <input type="text" id="user-input" placeholder="Type your message here..." />
      <button id="send-button">Send</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const chatMessages = document.getElementById('chat-messages');
      const userInput = document.getElementById('user-input');
      const sendButton = document.getElementById('send-button');
      let sitemapData = null;
      let isProcessing = false;

      // Load sitemap data
      async function loadSitemapData() {
        try {
          const response = await fetch('./sitemapData.json');
          if (response.ok) {
            sitemapData = await response.json();
            console.log('Sitemap data loaded successfully');
          } else {
            console.error('Failed to load sitemap data');
          }
        } catch (error) {
          console.error('Error loading sitemap data:', error);
        }
      }

      // Call this on page load
      loadSitemapData();

      // More natural and concise responses
      const botResponses = {
        greetings: [
          "Hi there! How can I help?",
          "Hello! What can I assist with today?",
          "Hey! What's on your mind?"
        ],
        services: [
          "We specialize in AI web design, custom software, and automation. What interests you?",
          "Our services include intelligent web design, AI integration, and business automation. Need details?",
          "We offer next-gen websites, AI agents, and digital marketing. Which would you like to know more about?"
        ],
        expertise: [
          "We're Cyprus's first AI web design agency - experts in intelligent automation and UX.",
          "We specialize in AI solutions for businesses in Cyprus and internationally.",
          "Our team combines tech expertise with business understanding to create intelligent solutions."
        ],
        contact: [
          "You can reach us at info@qualiasolutions.net or +357 99 111 668.",
          "Need a consultation? I'll connect you with our team.",
          "We'd love to discuss your project. How should we contact you?"
        ],
        thanks: [
          "You're welcome!",
          "Anytime!",
          "Happy to help!"
        ],
        humor: [
          "I'm not just artificially intelligent, I'm artificially charming too!",
          "I'd tell you a joke about AI, but my humor algorithm is still learning.",
          "If I were a human, I'd probably be the one asking you for tech support!"
        ],
        default: [
          "I can help with web design, AI solutions, or answer questions about Qualia.",
          "Tell me more about what you're looking for?",
          "Would you like to know about our services or past projects?"
        ]
      };

      function addMessage(text, isUser) {
        const message = document.createElement('div');
        message.classList.add('message');
        message.classList.add(isUser ? 'user-message' : 'bot-message');
        message.textContent = text;
        chatMessages.appendChild(message);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function addLoadingIndicator() {
        const loadingMessage = document.createElement('div');
        loadingMessage.classList.add('message', 'bot-message', 'loading');
        loadingMessage.id = 'loading-indicator';
        
        for (let i = 0; i < 3; i++) {
          const dot = document.createElement('div');
          dot.classList.add('loading-dot');
          loadingMessage.appendChild(dot);
        }
        
        chatMessages.appendChild(loadingMessage);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function removeLoadingIndicator() {
        const indicator = document.getElementById('loading-indicator');
        if (indicator) {
          indicator.remove();
        }
      }

      function searchSitemapData(query) {
        if (!sitemapData || !sitemapData.pages) return null;
        
        query = query.toLowerCase();
        let bestMatch = null;
        let highestScore = 0;
        
        for (const page of sitemapData.pages) {
          // Calculate a simple relevance score
          let score = 0;
          
          // Check title match
          if (page.title && page.title.toLowerCase().includes(query)) {
            score += 5;
          }
          
          // Check content match
          if (page.content && page.content.toLowerCase().includes(query)) {
            score += 3;
            
            // Extract a relevant excerpt
            const contentLower = page.content.toLowerCase();
            const index = contentLower.indexOf(query);
            if (index !== -1) {
              // Get a window of text around the match
              const start = Math.max(0, index - 100);
              const end = Math.min(page.content.length, index + query.length + 100);
              const excerpt = page.content.substring(start, end);
              
              // Store the excerpt with the page
              page.excerpt = excerpt;
              
              // Increase score for better matches
              score += 2;
            }
          }
          
          // Check headings match
          if (page.headings) {
            for (const heading of page.headings) {
              if (heading.text.toLowerCase().includes(query)) {
                score += 4;
              }
            }
          }
          
          if (score > highestScore) {
            highestScore = score;
            bestMatch = page;
          }
        }
        
        return highestScore > 0 ? bestMatch : null;
      }

      async function getResponse(text) {
        // Clean up text
        text = text.toLowerCase().trim();
        
        // Check for greetings
        if (text.match(/^(hi|hello|hey|greetings|good (morning|afternoon|evening))/)) {
          return botResponses.greetings[Math.floor(Math.random() * botResponses.greetings.length)];
        }
        
        // Check for thanks/appreciation
        if (text.match(/(thanks|thank you|appreciate it)/)) {
          return botResponses.thanks[Math.floor(Math.random() * botResponses.thanks.length)];
        }
        
        // Check for humor requests
        if (text.match(/(joke|funny|humor|tell me something funny)/)) {
          return botResponses.humor[Math.floor(Math.random() * botResponses.humor.length)];
        }
        
        // Check for services
        if (text.match(/(service|offer|provide|do you do|what do you do)/)) {
          return botResponses.services[Math.floor(Math.random() * botResponses.services.length)];
        }
        
        // Check for expertise
        if (text.match(/(expert|experience|specialize|good at|know about)/)) {
          return botResponses.expertise[Math.floor(Math.random() * botResponses.expertise.length)];
        }
        
        // Check for contact requests
        if (text.match(/(contact|speak|talk|consult|meet|book|schedule|email|phone)/)) {
          return botResponses.contact[Math.floor(Math.random() * botResponses.contact.length)];
        }
        
        // Check for agent requests
        if (text.match(/(agent|human|person|real|live)/)) {
          return "I'll connect you with a customer service agent shortly. Please wait a moment.";
        }
        
        // Search in sitemap data
        const matchedPage = searchSitemapData(text);
        if (matchedPage) {
          // Build a response based on the matched page
          if (matchedPage.excerpt) {
            return `Based on our website: ${matchedPage.excerpt}... You can read more at ${matchedPage.url}`;
          } else {
            // Use the page title and description
            return `You might find this page helpful: "${matchedPage.title}". ${matchedPage.description} Learn more at ${matchedPage.url}`;
          }
        }
        
        // Default response
        return botResponses.default[Math.floor(Math.random() * botResponses.default.length)];
      }

      function handleSend() {
        if (isProcessing) return;
        
        const text = userInput.value.trim();
        if (text) {
          addMessage(text, true);
          userInput.value = '';
          
          // Show loading indicator
          addLoadingIndicator();
          isProcessing = true;
          
          // Simulate typing delay with a minimum time to make it feel natural
          setTimeout(async () => {
            try {
              const response = await getResponse(text);
              removeLoadingIndicator();
              addMessage(response, false);
            } catch (error) {
              removeLoadingIndicator();
              addMessage("Sorry, I'm having trouble processing that right now. Could you try again?", false);
              console.error("Error generating response:", error);
            } finally {
              isProcessing = false;
            }
          }, 800); // Minimum delay of 800ms to simulate natural typing
        }
      }

      sendButton.addEventListener('click', handleSend);
      userInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          handleSend();
        }
      });
    });
  </script>
</body>
</html> 